<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Carta de Natal para Manu</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg1: #6b0f12;
            --bg2: #8c1418;
            --bg3: #b61d24;
            --ink: #2b1b1b;
            --paper: #fff7ef;
            --paper2: #fff2e4;
            --gold: #f6d37a;
            --line-height: 32px;
            --shadow: 0 20px 60px rgba(0,0,0,.35);
            --radius: 18px;
        }

        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            overflow-x: hidden;
        }

        body {
            font-family: 'Patrick Hand', cursive;
            color: var(--ink);
            
            /* Fundo vermelho texturizado natalino */
            background:
                radial-gradient(1200px 800px at 20% 10%, rgba(255,255,255,.08), transparent 60%),
                radial-gradient(900px 600px at 80% 30%, rgba(0,0,0,.18), transparent 60%),
                radial-gradient(1000px 700px at 40% 90%, rgba(255,255,255,.06), transparent 55%),
                linear-gradient(135deg, var(--bg1), var(--bg2) 45%, var(--bg3));
            position: relative;
            min-height: 100vh;
        }

        /* Tela de volume para mobile */
        .volume-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--bg1), var(--bg2) 45%, var(--bg3));
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 30px;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .volume-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .volume-content {
            text-align: center;
            max-width: 300px;
            color: white;
        }

        .volume-icon {
            font-size: 60px;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }

        .volume-title {
            font-size: 28px;
            font-family: 'Dancing Script', cursive;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .volume-text {
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.4;
            opacity: 0.9;
        }

        .volume-hint {
            font-size: 16px;
            padding: 12px 24px;
            background: rgba(255,255,255,0.15);
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.3);
            backdrop-filter: blur(10px);
            animation: blink 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Textura do fundo */
        body::before {
            content: "";
            position: fixed;
            inset: 0;
            pointer-events: none;
            opacity: .14;
            mix-blend-mode: overlay;
            background-image:
                repeating-linear-gradient(0deg, rgba(255,255,255,.06) 0 1px, transparent 1px 3px),
                repeating-linear-gradient(90deg, rgba(0,0,0,.05) 0 1px, transparent 1px 4px);
            filter: blur(.25px);
            z-index: 1;
        }

        /* Gr√£o/textura adicional */
        .grain {
            position: fixed;
            inset: 0;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='0.07'/%3E%3C/svg%3E");
            animation: grainMove .8s steps(2) infinite;
            z-index: 2;
        }

        @keyframes grainMove {
            0% { transform: translate(0,0); }
            25% { transform: translate(-1px,1px); }
            50% { transform: translate(1px,-1px); }
            75% { transform: translate(-1px,-1px); }
            100% { transform: translate(0,0); }
        }

        /* Neve em canvas */
        #snow {
            position: fixed;
            inset: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
        }

        /* Container principal */
        .wrap {
            position: relative;
            z-index: 4;
            padding: 40px 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Cart√£o principal */
        .card {
            width: 100%;
            max-width: 800px;
            background:
                radial-gradient(1400px 500px at 50% 0%, rgba(255,255,255,.9), rgba(255,255,255,.0) 65%),
                linear-gradient(180deg, var(--paper), var(--paper2));
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,.35);
            margin-bottom: 40px;
            transition: filter 0.3s ease;
        }

        /* Borda dourada sutil */
        .card::before {
            content: "";
            position: absolute;
            inset: 10px;
            border-radius: calc(var(--radius) - 8px);
            border: 1px solid rgba(246,211,122,.55);
            pointer-events: none;
        }

        /* Faixa de Natal */
        .ribbon {
            position: absolute;
            top: 20px;
            right: -65px;
            transform: rotate(22deg);
            background: linear-gradient(90deg, #b01b20, #d12a30);
            color: #fff;
            padding: 10px 80px;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            letter-spacing: .06em;
            font-weight: 700;
            box-shadow: 0 14px 26px rgba(0,0,0,.25);
            border: 1px solid rgba(255,255,255,.25);
            text-transform: uppercase;
            font-size: 13px;
            z-index: 10;
        }

        /* Cabe√ßalho da carta */
        header {
            padding: 50px 30px 20px;
            text-align: center;
            position: relative;
        }

        .title {
            margin: 0;
            font-size: clamp(28px, 4vw, 42px);
            line-height: 1.05;
            color: #3a1416;
            letter-spacing: -0.02em;
            text-shadow: 0 1px 0 rgba(255,255,255,.35);
            font-family: 'Dancing Script', cursive;
        }

        .subtitle {
            margin: 14px auto 0;
            max-width: 58ch;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            font-size: 15px;
            color: rgba(43,27,27,.72);
        }

        /* Selo de Natal */
        .seal {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-top: 18px;
            background:
                radial-gradient(circle at 30% 30%, rgba(255,255,255,.55), transparent 40%),
                radial-gradient(circle at 60% 70%, rgba(0,0,0,.22), transparent 45%),
                linear-gradient(135deg, #c9a14a, #f6d37a, #c9a14a);
            box-shadow: 0 10px 18px rgba(0,0,0,.18);
            border: 1px solid rgba(0,0,0,.08);
            user-select: none;
        }
        .seal span {
            font-size: 26px;
            filter: drop-shadow(0 1px 0 rgba(255,255,255,.35));
        }

        /* Conte√∫do principal */
        main {
            padding: 20px 30px 40px;
        }

        article {
            font-size: 19px;
            line-height: 1.7;
            color: rgba(43,27,27,.92);
            position: relative;
        }

        article h2 {
            font-size: 17px;
            margin: 22px 0 10px;
            letter-spacing: .08em;
            text-transform: uppercase;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            color: rgba(90,40,42,.8);
        }

        article p {
            margin: 14px 0;
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,.14), transparent);
            margin: 24px 0;
        }

        /* Polaroid Container (Mobile) */
        .polaroid-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            position: relative;
            z-index: 5;
        }

        /* Polaroid Estilo */
        .polaroid {
            width: 160px;
            background: #fff;
            padding: 12px 12px 28px;
            box-shadow: 0 12px 28px rgba(0,0,0,.35);
            position: relative;
            opacity: 0;
            transform: translateY(20px) rotate(var(--rot, 0deg));
            transition: all 0.6s cubic-bezier(.22,1,.36,1);
            cursor: pointer;
            border-radius: 2px;
            z-index: 50;
        }

        .polaroid.visible {
            opacity: 1;
            transform: translateY(0) rotate(var(--rot, 0deg));
        }

        .polaroid img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            display: block;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 1px;
        }

        /* Fita da polaroid */
        .polaroid::before {
          content: "";
          position: absolute;
          top: -14px;
          left: 50%;
          width: 70px;
          height: 24px;
          background: rgba(255,255,255,0.55);
          border: 1px solid rgba(0,0,0,0.08);
          box-shadow: 0 3px 6px rgba(0,0,0,.25);
          transform: translateX(-50%) rotate(-3deg);
        }

        /* Legenda */
        .caption {
            text-align: center;
            font-size: 15px;
            margin-top: 8px;
            color: #444;
            font-weight: 500;
        }

        /* Efeitos de hover/intera√ß√£o */
        .polaroid:hover,
        .polaroid:active {
            transform: translateY(-8px) rotate(calc(var(--rot, 0deg) * 0.3)) scale(1.05);
            box-shadow: 0 28px 60px rgba(0,0,0,.45);
            z-index: 999;
        }

        /* Polaroid focada (modo visualiza√ß√£o) */
        .polaroid.focused {
            position: fixed !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) rotate(0deg) scale(1.2) !important;
            box-shadow: 0 40px 90px rgba(0,0,0,.75);
            z-index: 1002 !important;
            width: 280px;
            opacity: 1 !important;
            filter: none !important;
        }

        .polaroid.focused img {
            height: 240px;
        }

        /* Overlay para modo focado - CORRIGIDO: sem blur no overlay */
        .polaroid-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.5);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
            z-index: 1001;
            /* REMOVIDO: backdrop-filter: blur(2px); */
        }

        .polaroid-overlay.active {
            pointer-events: all;
        }

        /* Estado quando uma polaroid est√° aberta */
        .polaroid-open .grain,
        .polaroid-open #snow {
            filter: blur(3px);
        }

        /* Manu */
        #Name {
            font-size: 22px;
            color: #000000;
        }

        /* Rodap√© */
        footer {
            padding: 0 30px 30px;
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            color: rgba(43,27,27,.65);
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
            font-size: 14px;
        }

        .signature {
            font-weight: 700;
            color: rgba(58,20,22,.85);
            font-family: 'Dancing Script', cursive;
            font-size: 20px;
        }

        .hint {
            opacity: .8;
        }

        /* Brilho natalino */
        .glow {
            position: absolute;
            inset: -80px -80px auto -80px;
            height: 240px;
            background: radial-gradient(closest-side, rgba(246,211,122,.35), transparent 70%);
            filter: blur(2px);
            pointer-events: none;
        }

        /* Estilo da folha de di√°rio */
        .diary-text {
            background:
                repeating-linear-gradient(
                    to bottom,
                    #fff,
                    #fff calc(var(--line-height) - 1px),
                    #f0f0f0 var(--line-height)
                );
            padding: 25px 30px 25px 45px;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            box-shadow: inset 0 0 0 1px rgba(0,0,0,.05);
        }

        .diary-text::before {
            content: "";
            position: absolute;
            left: 30px;
            top: 0;
            width: 2px;
            height: 100%;
            background: #e06b6b;
        }

        /* Responsividade */
        @media (max-width: 600px) {
            /* Volume screen aparece apenas em mobile */
            .volume-screen {
                display: flex;
            }
            
            .wrap {
                padding: 30px 15px;
            }
            
            header, main, footer {
                padding-left: 20px;
                padding-right: 20px;
            }
            
            .ribbon {
                font-size: 11px;
                right: -55px;
                padding: 8px 60px;
            }
            
            article {
                font-size: 18px;
            }
            
            .polaroid-container {
                gap: 15px;
            }
            
            .polaroid {
                width: 140px;
            }
            
            .polaroid img {
                height: 120px;
            }
            
            .polaroid.focused {
                width: 250px;
                transform: translate(-50%, -50%) rotate(0deg) scale(1.15) !important;
            }
            
            .polaroid.focused img {
                height: 210px;
            }
        }

        @media (min-width: 601px) {
            /* Volume screen escondida em desktop */
            .volume-screen {
                display: none;
            }
        }

        @media (max-width: 400px) {
            .polaroid {
                width: 130px;
            }
            
            .polaroid img {
                height: 110px;
            }
            
            .title {
                font-size: 26px;
            }
            
            .polaroid.focused {
                width: 220px;
            }
            
            .polaroid.focused img {
                height: 180px;
            }
        }

        @media (max-width: 350px) {
            .polaroid-container {
                gap: 12px;
            }
            
            .polaroid {
                width: 120px;
            }
            
            .polaroid img {
                height: 100px;
            }
            
            .polaroid.focused {
                width: 200px;
            }
            
            .polaroid.focused img {
                height: 160px;
            }
            
            .volume-title {
                font-size: 24px;
            }
            
            .volume-text {
                font-size: 16px;
            }
        }

        /* Acessibilidade - reduzir movimento */
        @media (prefers-reduced-motion: reduce) {
            #snow, .grain {
                display: none !important;
            }
            
            .volume-icon {
                animation: none;
            }
            
            .volume-hint {
                animation: none;
            }
            
            .polaroid {
                transition: opacity 0.3s ease;
            }
            
            .polaroid.focused {
                transition: transform 0.3s ease;
            }
        }
    </style>
</head>

<body>
    <!-- Tela de volume para mobile -->
    <div class="volume-screen" id="volumeScreen">
        <div class="volume-content">
            <div class="volume-icon">üîä</div>
            <h1 class="volume-title">Aumente o volume</h1>
            <p class="volume-text">Para uma experi√™ncia completa, ajuste o volume do seu dispositivo antes de continuar.</p>
            <div class="volume-hint">Toque para come√ßar</div>
        </div>
    </div>

    <!-- Elementos de √°udio -->
    <audio id="backgroundMusic" loop>
        <source src="audio.mp3" type="audio/mpeg">
        Seu navegador n√£o suporta o elemento de √°udio.
    </audio>

    <canvas id="snow" aria-hidden="true"></canvas>
    <div class="grain"></div>
    <div class="polaroid-overlay"></div>

    <div class="wrap">
        <section class="card" role="article" aria-label="Cartinha de Natal">
            <div class="glow"></div>
           <!--<div class="ribbon">Carta de Natal para Manu</div>-->

            <header>
                <h1 class="title">Feliz Natal, Meu Amor! ‚ù§Ô∏è</h1>
                <p class="subtitle">
                    Uma cartinha para a mulher da minha vida!
                </p>
                <div class="seal" title="Com amor">
                    <span>üéÑ</span>
                </div>
            </header>

            <main>
                <article>
                    <!--<h2>Algumas p√°ginas do nosso di√°rio...</h2>-->
                    
                    <div class="diary-text">
                      <p>Oi, Amor!<br/>
                        Fiz essa cartinha pra voc√™!<br/>
                        Come√ßo dizendo que n√£o sou muito bom com palavras, mas o amor que eu sinto por ti vai muito al√©m do que eu consigo expressar.
                      </p>  
                      
                      <p><strong>21 de Agosto de 2021</strong><br/>
                        Quem diria que esse dia iria definir nosso futuro juntos, n√©?</p>
                        
                        <p>Eu nunca me imaginei amando tanto uma pessoa assim. Eu mesmo disse, quando nos conhecemos, 
                          que eu n√£o queria mais relacionamento s√©rio com ningu√©m e que n√£o acreditava mais no amor. E olha eu aqui, com uma
                        fam√≠lia linda que constru√≠mos juntos.</p>

                      </div>
                      
                      <!-- Container de Polaroids -->

                      <div class="polaroid-container">
                        <!-- Polaroid 1 -->
                        <div class="polaroid reveal" data-rot="-5">
                          <img src="foto6.jpg">
                          <div class="caption">21 de outubro de 2021</div>
                        </div>

                      <div class="polaroid-container">                        
                        <!-- Polaroid 2 -->
                        <div class="polaroid reveal" data-rot="3">
                          <img src="foto5.jpg">
                          <div class="caption">19 de junho de 2022</div>
                        </div>

                        <!-- Polaroid 2 -->
                        <div class="polaroid reveal" data-rot="-3">
                          <img src="foto2.jpg">
                          <div class="caption">30 de setembro de 2023</div>
                        </div>
                        
                        <!-- Polaroid 3 -->
                        <div class="polaroid reveal" data-rot="6">
                          <img src="foto3.jpg">
                            <div class="caption">10 de agosto de 2024</div>
                        </div>
                        
                        <!-- Polaroid 4 -->
                        <div class="polaroid reveal" data-rot="-6">
                          <img src="foto4.webp">
                          <div class="caption">15 de setembro de 2025</div>
                        </div>
                      </div>
                      
                      <div class="divider"></div>
                      
                      <div class="diary-text">
                        
                        <p>„Ö§„Ö§„Ö§„Ö§„Ö§A<strong id="Name">M</strong>OROSA<br/>
                          „Ö§„Ö§„Ö§„Ö§„Ö§P<strong id="Name">A</strong>RCEIRA<br/>
                          „Ö§„Ö§„Ö§„Ö§„Ö§SI<strong id="Name">N</strong>CERA<br/>
                          „Ö§„Ö§„Ö§„Ö§„Ö§ G<strong id="Name">U</strong>ERREIRA<br/></p>
                          
                          <p>Acredito que seja o melhor significado para Manu, pois √© tudo o que eu vejo em ti.</p>
                          
                          <p>N√£o existe pessoa melhor para escolher passar o resto da vida. </p>
                          
                          <p>Te agrade√ßo por cada momento, cada demonstra√ß√£o de carinho. Te agrade√ßo por estar ao meu lado sempre.</p>

                          <p>Junto com essa carta, deixei um vale-presente simb√≥lico de R$200, espero que fa√ßa bom uso!</p>
                        </div>

                    <div class="divider"></div>

                    <p style="text-align: center; font-style: italic; color: #8c1418;">
                        "E eu escolheria voc√™; em cem vidas, em cem mundos, em qualquer vers√£o da realidade, eu te encontraria e te escolheria."<br/>
                        <p style="text-align: right; font-style: italic; color: #000000;">‚Äî Kiersten White</p>
                    </p>
                </article>
            </main>

            <footer>
                <div>
                    <span class="hint">Com todo meu amor,</span>
                    <span class="signature">‚Äî Vinicius</span>
                </div>
                <div class="hint" id="date"></div>
            </footer>
        </section>
    </div>

    <script>
        // Sistema de tela de volume para mobile
        (function() {
            const volumeScreen = document.getElementById('volumeScreen');
            const backgroundMusic = document.getElementById('backgroundMusic');
            
            // Verifica se √© dispositivo m√≥vel
            function isMobileDevice() {
                return (typeof window.orientation !== "undefined") || (navigator.userAgent.indexOf('IEMobile') !== -1) ||
                       /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }
            
            // Se n√£o for mobile, esconde a tela imediatamente
            if (!isMobileDevice()) {
                volumeScreen.classList.add('hidden');
                // Toca a m√∫sica automaticamente em desktop
                playMusic();
            } else {
                // Adiciona evento de clique para mobile
                volumeScreen.addEventListener('click', function() {
                    // Esconde a tela
                    this.classList.add('hidden');
                    
                    // Toca a m√∫sica
                    playMusic();
                    
                    // Remove o evento ap√≥s o primeiro clique
                    this.removeEventListener('click', arguments.callee);
                });
                
                // Tamb√©m permite tocar em qualquer lugar da tela
                volumeScreen.addEventListener('touchstart', function(e) {
                    // Previne comportamento padr√£o
                    e.preventDefault();
                    
                    // Esconde a tela
                    this.classList.add('hidden');
                    
                    // Toca a m√∫sica
                    playMusic();
                    
                    // Remove o evento ap√≥s o primeiro toque
                    this.removeEventListener('touchstart', arguments.callee);
                }, { passive: false });
            }
            
            function playMusic() {
                // Configura o √°udio
                backgroundMusic.volume = 0.5; // Volume inicial moderado
                backgroundMusic.play().catch(function(error) {
                    console.log("Erro ao reproduzir √°udio:", error);
                    // Alguns navegadores bloqueiam autoplay, ent√£o tentamos novamente ap√≥s intera√ß√£o do usu√°rio
                    document.addEventListener('click', function tryPlayOnce() {
                        backgroundMusic.play().catch(e => console.log("Ainda n√£o foi poss√≠vel tocar:", e));
                        document.removeEventListener('click', tryPlayOnce);
                    });
                });
            }
        })();

        // Data formatada
        (function(){
            const el = document.getElementById("date");
            // Especificar hor√°rio local (meia-noite em S√£o Paulo)
            const now = new Date("2025-12-25T00:00:00-03:00");
            const fmt = new Intl.DateTimeFormat("pt-BR", { 
                dateStyle: "full",
                timeZone: "America/Sao_Paulo"
            });
            el.textContent = fmt.format(now);
        })();

        // Sistema de neve
        (function(){
            const canvas = document.getElementById("snow");
            const ctx = canvas.getContext("2d", { alpha: true });
            let w, h, dpr;
            const flakes = [];
            const MAX_FLAKES = 120;
            const wind = { x: 0.25, target: 0.25 };

            function resize(){
                dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
                w = canvas.width  = Math.floor(window.innerWidth * dpr);
                h = canvas.height = Math.floor(window.innerHeight * dpr);
                canvas.style.width  = window.innerWidth + "px";
                canvas.style.height = window.innerHeight + "px";
            }

            function rand(min, max){ 
                return Math.random() * (max - min) + min; 
            }

            function makeFlake(spawnTop=true){
                const r = rand(1.2, 4) * dpr;
                return {
                    x: rand(0, w),
                    y: spawnTop ? rand(-h * 0.1, 0) : rand(0, h),
                    r,
                    vy: rand(0.5, 1.8) * dpr,
                    vx: rand(-0.2, 0.2) * dpr,
                    alpha: rand(0.3, 0.85),
                    wobble: rand(0, Math.PI * 2),
                    wobbleSpeed: rand(0.006, 0.018)
                };
            }

            function init(){
                resize();
                flakes.length = 0;
                for(let i=0; i<MAX_FLAKES; i++){
                    flakes.push(makeFlake(false));
                }
            }

            function step(){
                // Vento suave
                wind.target += rand(-0.008, 0.008);
                wind.target = Math.max(-0.4, Math.min(0.6, wind.target));
                wind.x += (wind.target - wind.x) * 0.01;

                ctx.clearRect(0, 0, w, h);

                for(const f of flakes){
                    f.wobble += f.wobbleSpeed;
                    const sway = Math.sin(f.wobble) * 0.5 * dpr;

                    f.x += (f.vx + wind.x) + sway * 0.12;
                    f.y += f.vy;

                    // Desenhar floco
                    ctx.beginPath();
                    ctx.fillStyle = `rgba(255,255,255,${f.alpha})`;
                    ctx.arc(f.x, f.y, f.r, 0, Math.PI * 2);
                    ctx.fill();

                    // Reset quando sai da tela
                    if(f.y > h + 8*dpr || f.x < -15*dpr || f.x > w + 15*dpr){
                        const nf = makeFlake(true);
                        Object.assign(f, nf);
                    }
                }

                requestAnimationFrame(step);
            }

            // Respeitar prefer√™ncia de redu√ß√£o de movimento
            const reduceMotion = window.matchMedia && 
                window.matchMedia("(prefers-reduced-motion: reduce)").matches;
            if(!reduceMotion){
                init();
                step();
                window.addEventListener("resize", resize, { passive:true });
            }
        })();

          // Sistema de Polaroids Interativas - CORRIGIDO E MELHORADO
          document.addEventListener('DOMContentLoaded', function() {
              const polaroids = document.querySelectorAll('.polaroid');
              const overlay = document.querySelector('.polaroid-overlay');
              const body = document.body;
              let activePolaroid = null;
              let isAnimating = false; // Flag para evitar m√∫ltiplas anima√ß√µes
              
              // Aplicar rota√ß√µes aleat√≥rias
              polaroids.forEach(polaroid => {
                  const rot = polaroid.getAttribute('data-rot') || 
                            (Math.random() * 12 - 6).toFixed(1);
                  polaroid.style.setProperty('--rot', `${rot}deg`);
              });
              
              // Observer para anima√ß√£o de entrada
              const observer = new IntersectionObserver(entries => {
                  entries.forEach(entry => {
                      if (entry.isIntersecting) {
                          setTimeout(() => {
                              entry.target.classList.add('visible');
                          }, 100 * Array.from(polaroids).indexOf(entry.target));
                      }
                  });
              }, { threshold: 0.15 });
              
              polaroids.forEach(polaroid => observer.observe(polaroid));
              
              // Intera√ß√£o com as polaroids
              polaroids.forEach(polaroid => {
                  polaroid.addEventListener('click', function(e) {
                      e.stopPropagation();
                      e.preventDefault();
                      
                      // Previne m√∫ltiplos cliques r√°pidos
                      if (isAnimating) return;
                      
                      // Se j√° est√° focada, fecha
                      if (this.classList.contains('focused')) {
                          closePolaroid();
                          return;
                      }
                      
                      // Se j√° existe uma polaroid aberta, fecha ela primeiro
                      if (activePolaroid && activePolaroid !== this) {
                          closePolaroid(() => {
                              // Depois de fechar, abre a nova
                              setTimeout(() => openPolaroid(this), 150);
                          });
                          return;
                      }
                      
                      // Abre a polaroid
                      openPolaroid(this);
                  });
              });
              
              // Fechar ao clicar no overlay
              overlay.addEventListener('click', function(e) {
                  if (e.target === this && activePolaroid && !isAnimating) {
                      closePolaroid();
                  }
              });
              
              // Fechar com ESC
              document.addEventListener('keydown', function(e) {
                  if (e.key === 'Escape' && activePolaroid && !isAnimating) {
                      closePolaroid();
                  }
              });
              
              function openPolaroid(polaroid) {
                  isAnimating = true;
                  activePolaroid = polaroid;
                  
                  // Desativa temporariamente o clique em outras polaroids
                  polaroids.forEach(p => {
                      if (p !== polaroid) {
                          p.style.pointerEvents = 'none';
                      }
                  });
                  
                  // Salva a posi√ß√£o original para restaurar depois
                  const rect = polaroid.getBoundingClientRect();
                  polaroid.dataset.originalTop = rect.top + 'px';
                  polaroid.dataset.originalLeft = rect.left + 'px';
                  polaroid.dataset.originalWidth = polaroid.offsetWidth + 'px';
                  polaroid.dataset.originalHeight = polaroid.offsetHeight + 'px';
                  
                  // Adiciona classe ao body para aplicar blur no fundo
                  body.classList.add('polaroid-open');
                  
                  // Adiciona classe focada
                  polaroid.classList.add('focused');
                  
                  // Ativa o overlay com um pequeno delay para melhor anima√ß√£o
                  setTimeout(() => {
                      overlay.classList.add('active');
                      isAnimating = false;
                  }, 10);
                  
                  // Previne scroll quando polaroid est√° aberta
                  document.body.style.overflow = 'hidden';
              }
              
              function closePolaroid(callback) {
                  if (!activePolaroid || isAnimating) return;
                  
                  isAnimating = true;
                  
                  // Remove classes
                  activePolaroid.classList.remove('focused');
                  overlay.classList.remove('active');
                  
                  // Remove blur do fundo ap√≥s anima√ß√£o
                  setTimeout(() => {
                      body.classList.remove('polaroid-open');
                      
                      // Reativa clique em todas as polaroids
                      polaroids.forEach(p => {
                          p.style.pointerEvents = '';
                      });
                      
                      // Restaura scroll
                      document.body.style.overflow = '';
                      
                      // Limpa a refer√™ncia
                      const wasActive = activePolaroid;
                      activePolaroid = null;
                      isAnimating = false;
                      
                      // Executa callback se existir
                      if (callback && typeof callback === 'function') {
                          callback();
                      }
                  }, 300);
              }
              
              // Melhorias para touch em dispositivos m√≥veis
              let touchStartY = 0;
              let touchStartX = 0;
              let touchStartTime = 0;
              
              document.addEventListener('touchstart', function(e) {
                  if (activePolaroid) {
                      touchStartY = e.touches[0].clientY;
                      touchStartX = e.touches[0].clientX;
                      touchStartTime = Date.now();
                  }
              }, { passive: true });
              
              document.addEventListener('touchend', function(e) {
                  if (activePolaroid && e.target === overlay && !isAnimating) {
                      const touchEndY = e.changedTouches[0].clientY;
                      const touchEndX = e.changedTouches[0].clientX;
                      const touchDuration = Date.now() - touchStartTime;
                      
                      // Fecha se foi um toque simples (n√£o um arraste) e r√°pido (< 300ms)
                      if (Math.abs(touchEndY - touchStartY) < 15 && 
                          Math.abs(touchEndX - touchStartX) < 15 &&
                          touchDuration < 300) {
                          closePolaroid();
                      }
                  }
              }, { passive: true });
              
              // Fechar polaroid ao rolar em dispositivos m√≥veis (opcional)
              let lastScrollTop = 0;
              let scrollTimeout;
              
              window.addEventListener('scroll', function() {
                  if (activePolaroid && !isAnimating) {
                      // Detecta se o usu√°rio est√° rolando significativamente
                      const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                      
                      if (Math.abs(scrollTop - lastScrollTop) > 30) {
                          closePolaroid();
                      }
                      
                      lastScrollTop = scrollTop;
                      
                      // Limpa timeout anterior
                      clearTimeout(scrollTimeout);
                      
                      // Se o usu√°rio parar de rolar, reseta
                      scrollTimeout = setTimeout(() => {
                          lastScrollTop = scrollTop;
                      }, 100);
                  }
              }, { passive: true });
              
              // Tooltip educacional (s√≥ aparece uma vez)
              if (!sessionStorage.getItem('polaroidHintShown')) {
                  setTimeout(() => {
                      const hint = document.createElement('div');
                      hint.innerHTML = '‚ú® Clique nas fotos para ampli√°-las!<br><small>(Apenas uma por vez)</small>';
                      hint.style.cssText = `
                          position: fixed;
                          top: 20px;
                          left: 50%;
                          transform: translateX(-50%);
                          background: rgba(182, 29, 36, 0.95);
                          color: white;
                          padding: 12px 24px;
                          border-radius: 25px;
                          font-size: 14px;
                          z-index: 1001;
                          animation: fadeHint 4s forwards;
                          pointer-events: none;
                          text-align: center;
                          max-width: 85%;
                          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                          font-family: ui-sans-serif, system-ui, -apple-system, sans-serif;
                          line-height: 1.4;
                      `;
                      
                      const style = document.createElement('style');
                      style.textContent = `
                          @keyframes fadeHint {
                              0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                              15% { opacity: 1; transform: translateX(-50%) translateY(0); }
                              85% { opacity: 1; transform: translateX(-50%) translateY(0); }
                              100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
                          }
                      `;
                      
                      document.head.appendChild(style);
                      document.body.appendChild(hint);
                      
                      setTimeout(() => {
                          hint.remove();
                          sessionStorage.setItem('polaroidHintShown', 'true');
                      }, 4000);
                  }, 1500);
              }
          });
            
            // Melhorias para touch em dispositivos m√≥veis
            let touchStartY = 0;
            let touchStartX = 0;
            
            document.addEventListener('touchstart', function(e) {
                if (activePolaroid) {
                    touchStartY = e.touches[0].clientY;
                    touchStartX = e.touches[0].clientX;
                }
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                if (activePolaroid && e.target === overlay) {
                    const touchEndY = e.changedTouches[0].clientY;
                    const touchEndX = e.changedTouches[0].clientX;
                    
                    // Fecha se foi um toque simples (n√£o um arraste)
                    if (Math.abs(touchEndY - touchStartY) < 10 && 
                        Math.abs(touchEndX - touchStartX) < 10) {
                        closePolaroid();
                    }
                }
            });
    </script>
</body>
</html>